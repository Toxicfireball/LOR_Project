{% extends "base.html" %}
{% block title %}{{ m.name }} Â· Martial Mastery{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto">
  <a href="{% url 'characters:codex_masteries' %}" class="text-sm text-blue-700 hover:underline">&larr; Back to Masteries</a>

  <div class="bg-white rounded-lg shadow p-6 mt-3">
    <div class="flex items-start justify-between gap-4">
      <div>
        <h1 class="text-2xl font-bold">{{ m.name }}</h1>
        <div class="mt-2 flex flex-wrap gap-2">
          <span class="px-2 py-0.5 text-xs rounded bg-gray-100">Level {{ m.level_required }}</span>
          <span class="px-2 py-0.5 text-xs rounded bg-blue-100 text-blue-700">Cost {{ m.points_cost }}</span>
          {% if m.action_cost %}<span class="px-2 py-0.5 text-xs rounded bg-amber-100 text-amber-800">{{ m.get_action_cost_display }}</span>{% endif %}
          {% if m.is_rare %}<span class="px-2 py-0.5 text-xs rounded bg-purple-100 text-purple-700">Rare</span>{% endif %}
          {% if m.restrict_by_ability %}
            <span class="px-2 py-0.5 text-xs rounded bg-red-100 text-red-700">
              Requires {{ m.get_required_ability_display }} {{ m.required_ability_score }}
            </span>
          {% endif %}
        </div>
      </div>
    </div>

    {% if m.description %}
      <div class="prose prose-sm mt-4">
        {{ m.description|safe }}
      </div>
    {% endif %}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
      <div>
        <h2 class="font-semibold mb-2">Availability</h2>
        <div class="text-sm">
          <div><span class="font-medium">Classes:</span>
            {% if m.all_classes %} Any class{% else %} {{ m.classes.all|join:", " }}{% endif %}
          </div>
          <div class="mt-2"><span class="font-medium">Range Types:</span>
            {% if m.restrict_to_range %}
              {{ m.allowed_range_types|join:", " }}
            {% else %}
              Not restricted
            {% endif %}
          </div>
        </div>

        <h2 class="font-semibold mt-6 mb-2">Weapon / Trait / Damage Restrictions</h2>
        <ul class="text-sm list-disc pl-5 space-y-1">
          <li><span class="font-medium">Weapons:</span>
            {% if m.restrict_to_weapons %}
              {% with m.allowed_weapons.all as ws %} {{ ws|join:", " }}{% endwith %}
            {% else %} Not restricted{% endif %}
          </li>
          <li><span class="font-medium">Traits ({{ m.trait_match_mode|upper }}):</span>
            {% if m.restrict_to_traits %}
              {% with m.allowed_traits.all as ts %} {{ ts|join:", " }}{% endwith %}
            {% else %} Not restricted{% endif %}
          </li>
          <li><span class="font-medium">Damage Types:</span>
            {% if m.restrict_to_damage and m.allowed_damage_types %}
              {{ m.allowed_damage_types|join:", " }}
            {% else %} Not restricted{% endif %}
          </li>
        </ul>
      </div>

      <div>
        <h2 class="font-semibold mb-2">Details</h2>
        <div class="text-sm text-gray-700 space-y-2">
          <p><span class="font-medium">Level</span> is the minimum character level to pick this mastery. <span class="font-medium">Cost</span> is Martial Mastery points required.</p>
          <p>If an <span class="font-medium">Ability Requirement</span> is shown, the character must meet it at the time of selection.</p>
          <p>Restrictions define which weapons (or traits/damage types) this mastery can be used with.</p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
